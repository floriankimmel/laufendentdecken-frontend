---
import { Image, getImage } from 'astro:assets';
import { WORDPRESS_API_EPISODES_URL } from '../consts';
const { slug, index } = Astro.props;

const res = await fetch(`${WORDPRESS_API_EPISODES_URL}?slug=${slug}&_embed`)
const [post] = await res.json();
const height = index == 0 ? `420px` : `220px`;
const width = index == 0 ? '100%' : '374px';

var src = post._embedded['wp:featuredmedia']['0'].media_details.sizes.large?.source_url
if (!src) {
    src = post._embedded['wp:featuredmedia']['0'].media_details.sizes.full.source_url
}
const optimizedImage = await getImage({
    src,
    width:1020,
    height:510,
    format: 'avif',
})

---
<Image
    src={optimizedImage.src}
    class="img-fit"
    alt={post._embedded['wp:featuredmedia']['0'].alt_text}
    width=420
    height=374
    style={{
        width: width,
        objectFit: 'cover',
        height: height, 
    }}
/>
